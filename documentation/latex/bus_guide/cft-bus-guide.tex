\documentclass[11pt,a4paper,twocolumns]{article}
\usepackage[all]{xy}
\usepackage{tikz-timing}[2009/07/28]
\usetikztiminglibrary{either}[2009/07/28]
\usepackage{pdftricks}
\usepackage{epsfig}
\usepackage{lipsum}
\usepackage{float}
\usepackage{verbatim}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{color}
\usepackage{epic}
\usepackage{eepic}
\usepackage{fontspec}
\usepackage[dvipdfm,a4paper,CJKbookmarks,bookmarks=true,bookmarksopen=true]{hyperref}
\begin{psinputs}
\usepackage{color}
\usepackage{longtable}
\usepackage{pstcol}
\usepackage{pstricks}
\usepackage{pst-plot}
\usepackage{pst-tree}
\usepackage{pst-eps}
\usepackage{multido}
\usepackage{pst-node}
\usepackage{pst-eps}
\end{psinputs}
\definecolor{darkblue}{RGB}{0,0,128}
\hypersetup{
    pdftitle={CFT Minicomputer Bus Guide},
    pdfauthor={Alexios Chouchoulas},
    pdfkeywords={},
    bookmarksnumbered,
    pagebackref=true,
    breaklinks=true,
%    pdfview=FitH,       % Or try pdfstartview={FitV}, This lead to uncorrect bookmarks
    urlcolor=darkblue,
    colorlinks=true,
    citecolor=blue,          %citeref's color
    linkcolor=blue,
        }
% Fonts
%\defaultfontfeatures{Mapping=tex-text}
\setmainfont{Minion Pro}
\setsansfont{Myriad Pro}
\setmonofont[]{Inconsolata}

%\renewcommand{\rmdefault}{put}

\geometry{a4paper, hoffset=0in, voffset=-.25in, left=1.5cm, right=1.5cm,
  top=2.5cm, bottom=2.5cm}
\sloppy

% Use hyperlinking when renderind PDFs
\newcommand{\cf}[2][section]{\hyperref[#2]{#1 \ref*{#2} (p.~\pageref*{#2})}}
\newcommand{\npcf}[2][section]{\hyperref[#2]{#1 \ref*{#2}}}
\newcommand{\appcf}[1]{\cf[appendix]{#1}}
\newcommand{\ccf}[1]{\cf[chapter]{#1}}
\newcommand{\fcf}[1]{\cf[figure]{#1}}
\newcommand{\tcf}[1]{\cf[table]{#1}}
\newcommand{\ecf}[1]{\cf[equation]{#1}}
\newcommand{\algcf}[1]{\cf[algorithm]{#1}}
\newcommand{\npappcf}[1]{\npcf[appendix]{#1}}
\newcommand{\npccf}[1]{\npcf[chapter]{#1}}
\newcommand{\npfcf}[1]{\npcf[figure]{#1}}
\newcommand{\nptcf}[1]{\npcf[table]{#1}}
\newcommand{\npecf}[1]{\npcf[equation]{#1}}
\newcommand{\npalgcf}[1]{\npcf[algorithm]{#1}}

\setlength\columnsep{7mm}

\newcommand\hyperemail[1]{\sf\href{mailto:#1}{#1}}
\newcommand\link[1]{\sf\href{http://#1}{#1}}

\newcommand{\ns}[1]{$\overline{\mbox{\textsf{{#1}}}}$}
\newcommand{\ps}[1]{\textsf{#1}}

\newcommand\bus[1]{{#1}}
\newcommand\unit[1]{{#1}}
\newcommand\IBUS{\bus{IBUS}}
\newcommand\ALU{\unit{ALU}}
\newcommand\SBU{\unit{SBU}}
\newcommand\AGL{\unit{AGL}}
\newcommand\register[1]{\textsf{#1}}
\newcommand\A{\register{AC}}
\newcommand\Lreg{\register{L}}
\newcommand\Ireg{\register{I}}
\newcommand\MAR{\register{MAR}}
\newcommand\DR{\register{DR}}
\newcommand\PC{\register{PC}}
\newcommand\IR{\register{IR}}

\newcommand\UINSTR{\ns{uINSTR18}}
\newcommand\HALT{\ns{HALT}}
\newcommand\END{\ns{END}}
\newcommand\IRQ{\ns{IRQ}}
\newcommand\IRQS{\ns{IRQS}}
\newcommand\IRQn[1]{\ns{IRQ{#1}}}
\newcommand\RUNITn[1]{\ps{RUNIT{#1}}}
\newcommand\TPA{\ps{TPA}}
\newcommand\TPC{\ps{TPC}}
\newcommand\WAC{\ns{WAC}}
\newcommand\WALU{\ns{WALU}}
\newcommand\WDR{\ns{WDR}}
\newcommand\WIR{\ns{WIR}}
\newcommand\WMAR{\ns{WMAR}}
\newcommand\WPC{\ns{WPC}}
\newcommand\SYSDEV{\ns{SYSDEV}}
\newcommand\OPIFn[1]{\ps{OPIF{#1}}}
\newcommand\GUARDPULSE{\ns{GUARD}}
\newcommand\GP{\GUARDPULSE}
\newcommand\CLOCK[1]{\ps{CLK{#1}}}
\newcommand\RSTHOLD{\ns{RSTHOLD}}
\newcommand\BOE{\ns{BOE}}
\newcommand\UOE{\ns{UOE}}
\newcommand\SKIP{\ns{SKIP}}
\newcommand\AINDEX{\ps{AINDEX}}
\newcommand\CLL{\ns{CLL}}
\newcommand\CPL{\ns{CPL}}
\newcommand\CLI{\ns{CLI}}
\newcommand\STI{\ns{STI}}
\newcommand\IRn[1]{\ps{IR{#1}}}
\newcommand\PCn[1]{\ps{PC{#1}}}
\newcommand\IBUSn[1]{\ps{IBUS#1}}
\newcommand\DBUSn[1]{\ps{DB#1}}
\newcommand\ABUSn[1]{\ps{AB#1}}
\newcommand\AEXTn[1]{\ps{AEXT#1}}
\newcommand\ISROLL{\ps{ISROLL}}
\newcommand\RAC{\ns{RAC}}
\newcommand\RAGL{\ns{RAGL}}
\newcommand\RDR{\ns{RDR}}
\newcommand\RPC{\ns{RPC}}
\newcommand\INCAC{\ns{INCAC}}
\newcommand\INCDR{\ns{INCDR}}
\newcommand\INCPC{\ns{INCPC}}
\newcommand\MEM{\ns{MEM}}
\newcommand\IO{\ns{IO}}
\newcommand\R{\ns{R}}
\newcommand\WRITE{\ns{W}}
\newcommand\READ{\ns{R}}
\newcommand\FL{\ps{FL}}
\newcommand\FV{\ps{FV}}
\newcommand\FZERO{\ps{FZERO}}
\newcommand\FNEG{\ps{FNEG}}
\newcommand\RESET{\ns{RESET}}

\newcommand\NB{\textbf{Nota Bene:\ }}

\begin{document}
\thispagestyle{empty}
\pagestyle{plain}
\twocolumn[
\centering
\includegraphics{figs/cft-logo-v1.pdf}\vspace{2em}\\
{\LARGE\bf CFT Minicomputer Bus Guide}
\vspace{10pt}

{\Large Alexios Chouchoulas}\\\vspace{5pt}
{\large \hyperemail{alexios@bedroomlan.org}}

\vspace{20pt}

\begin{minipage}{.75\textwidth}
  \begin{abstract}
    \small
    
  This document discusses design and implementational details of the
  CFT backplane and bus. The design uses two separate buses, one for
  the processor and control logic, and one for memory and
  peripherals. The two buses are connected using a trivial bus bridge,
  as well as an optional interrupt controller and address space
  extension board to allow more than 65,536 words of memory.

  A basic discussion of non-normative mechanical and electrical
  properties is included, as well as a description of the semantics,
  direction and behaviour of all signals on the buses and their
  relation to other signals.
    
  \end{abstract}
  
  \section*{History of Changes}
  \small

  {\bf 2011-11-06} Initial revision.

  {\bf 2011-11-09} Clarified behaviour of reset mechanism. Froze
  definition of reset signals.

  {\bf 2011-11-10} Modified Control Bus pin-out. Added description for missing bus signals.

  {\bf 2011-11-15} Modified Control Bus pin-out (revision G). Removed
  \OPIFn{3}–\OPIFn{0} signals. Added \IRn{2}–\IRn{0}. Corrected power
  pin-out. Corrected minor issue with pin-out descriptions.

  {\bf 2011-11-20} Modified Control Bus pin-out (revision H) to
  include \FV{} signal.

  \vspace{5ex}
  
\end{minipage}
] % End of \twocolumn
\section{Introduction}

The CFT design incorporates two separate, bridged buses, both meant
for 96-pin DIN 41612 ‘Bauform C’ connectors and 100x160mm (3U)
Eurocards (IEEE 1101).

\begin{description}

\item{\bf The Control Bus} provides an interconnect for signals local
  to the processor part of the computer. This includes the
  \IBUS, signals from the Control Unit, and Microcode ROM, as well as
  signals to and from the ALU, register boards, interrupt controller
  boards, and all other processor components.

\item{\bf The Expansion Bus} provides a computer-level expansion
  interface. It allows devices to connect to the memory space, I/O
  space, and expanded memory space by using the Address Bus, Data Bus,
  their associated control lines, as well as interrupt lines.

\end{description}

The two buses are connected using a two-slot bus bridge card which
also implements the required expansion bus logic.

\section{Backplane}

The CFT backplane is based on a part available to the author at the
time when the CFT was originally designed. Historically, it belonged
to a computer used and possibly designed at the University of
Edinburgh's Department of Computer Science. The machines were
decommissioned circa 1993 and were based on a Motorola MC68020
microprocessor.

The backplane itself is a Eurocard (IEEE 1101) design using DIN 41612
connectors. The connectors are {\em Bauform\/} (style) ‘C’ 96-pin
receptacles.

Five power rails are provided at the edges of the card, occupying a
total of 6 rows, or 18 pins.

Of the remaining 78 pins, 2 pins per connector are not
bussed. Instead, they are broken out to test points on the
backplane. This leaves 76 pins for bus signals.

All 76 signal pins are terminated with 470Ω pull-up resistors.

Both buses share the same physical backplane. To isolate them, the
suggestion is to cut the traces between the last slot of the control
bus and the first slot of the expansion bus, and to provide
termination resistors on the bus bridge card.

If building the machine from scratch, two separate backplanes or DIN
41612 connectors on ribbon cables may be used, or the constructor may
develop a custom {\em ad hoc\/} solution. In the interest of allowing
implementations on other, possibly unterminated backplanes, optional
bus termination will also be provided on two cards, one on the control
side and one on the expansion side.

\begin{figure}[t]
\centering
\includegraphics{figs/din41612.pdf}\\
\caption{\label{fig-slot}A card receptacle on the CFT backplane (as
  seen from the top) showing the power and ground rails including one
  reserved for future expansion, as well as the two local test point
  pins. All other pins are connected across the backplane and
  terminated at either end.  }
\end{figure}

\section{Control Bus}

provides an interconnect for signals local to the processor part of
the computer. This includes the \IBUS, signals from the Control Unit,
and Microcode ROM, as well as signals to and from the ALU, register
boards, interrupt controller boards, and all other processor
components.

\begin{table}[t]
\caption{\label{table-control-pinout}Control Bus Pin-out.}
\centering
\begin{tabular}{rp{0.2\columnwidth}p{0.2\columnwidth}p{0.2\columnwidth}}
\noalign{\smallskip}\hline\noalign{\smallskip}
& A & B & C \\
\noalign{\smallskip}\hline\noalign{\smallskip}
 1 & GND         & GND       & GND \\
 2 & GND         & GND       & GND \\
 3 & +5V         & +5V       & +5V \\
 4 & Reserved    & Reserved  & Reserved \\
 5 & \IRn{0}     & \IRn{1}   & \IBUSn{0}\\
 6 & \IRn{2}     & Reserved  & \IBUSn{1}\\
 7 & \CLI        & \SKIP     & \IBUSn{2}\\
 8 & \STI        & \AINDEX   & \IBUSn{3}\\
 9 & \UINSTR     & \CLL      & \IBUSn{4}\\
10 & \HALT       & \CPL      & \IBUSn{5}\\
11 & \END        & Reserved  & \IBUSn{6}\\
12 & \IRQ        & \PCn{10}  & \IBUSn{7}\\
13 & \IRQS       & \PCn{11}  & \MEM \\
14 & \RUNITn{0}  & \PCn{12}  & \IO \\
15 & \RUNITn{1}  & \PCn{13}  & \READ \\
16 & \RUNITn{2}  & \PCn{14}  & \WRITE \\
17 & \TPA        & \PCn{15}  & \TPC \\
18 & \RUNITn{3}  & \ISROLL   & \FL \\
19 & \WAC        & \RAC      & \FZERO \\
20 & \WALU       & \RAGL     & \FNEG \\
21 & \WDR        & \RDR      & \IBUSn{8} \\
22 & \WIR        & \RPC      & \IBUSn{9} \\
23 & \WMAR       & \INCAC     & \IBUSn{10} \\
24 & \WPC        & \INCDR    & \IBUSn{11} \\
25 & \SYSDEV     & \INCPC    & \IBUSn{12} \\
26 & \FV         & Reserved  & \IBUSn{13} \\
27 & Reserved    & Reserved  & \IBUSn{14} \\
28 & \GUARDPULSE & \CLOCK{4} & \IBUSn{15} \\
29 & \CLOCK{5}   & \CLOCK{2} & \CLOCK{1} \\
30 & \RSTHOLD    & \CLOCK{3} & \RESET \\
31 & +12V        & +12V      & +12V \\
32 & +5V         & +5V       & +5V \\
\noalign{\smallskip}\hline\noalign{\smallskip}
\end{tabular}
\end{table}

The following is a description of the signals of the control bus.

\subsection{Power, Synchronisation and Initialisation}
\label{sec-bus-power-clock-reset}

Power is supplied on four power rails, connected directly to the power
supply.

\begin{description}
\item{\bf GND} (Pins A1–2, B1–2, C1–2) Connected
  to the power supply's ground rail.
\item{\bf +5V} (Pins A3, B3, C3, A32, B32, C32) Connected to the power supply's +5V rail.
\item{\bf Reserved Power Rail} (Pins A4, B4, C4) This is a power rail,
  although the exact voltage to be used has not yet been decided. A
  likely candidate is +3.3V, which is a fairly common voltage for many
  devices.
\item{\bf +12V} (Pins A31, B31, C31) Connected to the power supply's
  +12V rail.
\end{description}

Synchronisation and reset functionality is served by the following
signals, all of which are outputs:

\begin{description}
  \item{\bf \CLOCK{1}} (C29) is the main system clock phase, a 50\% duty
    cycle square wave. The exact period of this clock is beyond the
    scope of this document and is purposefully left unspecified.
  \item{\bf \CLOCK{2}} (B29) is the second phase of the clock. It is a 50\% duty
    cycle clock signal derived by shifting \CLOCK{1} by 90°.
  \item{\bf \CLOCK{3}} (B30) is the third phase of the clock. It is a
    50\% duty cycle clock signal derived by shifting \CLOCK{1} by 180°,
    which is tantamount to complementing \CLOCK{1}.
  \item{\bf \CLOCK{4}} (B28) is the fourth phase of the clock. It is a
    50\% duty cycle clock signal derived by shifting \CLOCK{1} by 270°,
    or shifting \CLOCK{2} by 180°, or complementing \CLOCK{2}.
  \item{\bf \CLOCK{5}} (A29) is a 75\% duty cycle square wave. Its
    falling edge coincides with the falling edge of \CLOCK{1} and its
    rising edge coincides with the rising edge of \CLOCK{4}, 90° and
    25\% of the period apart.
  \item{\bf\GP} (A28) The guard pulse is a 25\% (or
    less) duty cycle square wave, with its high level occurring just
    before the rising edge of \CLOCK{1}. It helps resolve bus
    contentions between faster and slower units within the processor
    by forcing most units to disconnect from the \IBUS{} when \GP{} is
    high.
\end{description}

Please refer to~\fcf{fig-clock} for a timing diagram of these clock phases.

Resetting the machine is handled by two signals, both of which are
outputs. Devices may reset on the falling edge or low level of either
or both of the two signals:

\begin{description}
  \item{\bf\RESET} (C30) When low, this short pulse indicates that a
    reset sequence has started. This signal may be driven low using an
    open collector to initiate a reset.
  \item{\bf\RSTHOLD} (A30) When low, pulse indicates a reset is in
    progress. This pulse starts shortly after the rising edge of
    \RESET{} and stays low for a relatively long time in terms of the
    machine's clock period.
\end{description}

\begin{figure}
\centering
\begin{tikztimingtable}
  \CLOCK{1} & L 2{C3H C3L} C2H \\
  \CLOCK{2} & 3L 2{C3H C3L} C \\
  \CLOCK{3} & H 2{C3L C3H} C2L \\
  \CLOCK{4} & 3H 2{C3L C3H} C \\
  \CLOCK{5} & 5H CLC5H CLC4H \\
  \GP       & 0.5L 2{0.5C0.5HC6L} 0.5C0.5HC 1.5L\\
%\extracode
%  \tablerules
%  \begin{pgfonlayer}{background}
%    \foreach \n in {1,...,8}
%      \draw [help lines] (A\n) -- (B\n);
%  \end{pgfonlayer}
\end{tikztimingtable}
\caption{\label{fig-clock}Clock timing diagram showing all the clock
  phases available to the Control Bus.}
\end{figure}

\subsection{Unit Control Signals}

These signals are all outputs from the microcode ROM. The microcode
ROM outputs values whenever \HALT{} is high. When \HALT{} goes low, the
ROM is tri-stated. Pull-up resistors pull these signals high, but
other units (including the front panel) may drive the signals low to
operate the CPU's units without the microcode ROM's intervention. This
allows hardware expansions to the CFT processor to be implemented, if
necessary.

\begin{description}
\item{\bf \CLI} (A7) When low, this signal clears the Interrupt register,
  disabling subsequent interrupts.
\item{\bf \STI} (A8) When low, this signal sets the Interrupt register, enabling interrupts.
\item{\bf \UINSTR} (A9) Bit 18 of the currently executing
  microinstruction. This is unused in the current versions of the
  microcode, but the signal is broken out onto the bus for future
  expansion. This signal is pulled up.
\item{\bf \END} (A11) Is low at the end of the current microprogram.
\item{\bf \RUNITn{3}–\RUNITn{0}} (A18, A16–A14) The corresponding
  unit is output to the \IBUS. This group of signals is undecoded in
  the sequencer unit, since other units (including the \ALU) need to
  perform their own decoding.
  \begin{description}
    \item{\bf \textsf{0000}} Idle; no unit outputs to the \IBUS.
    \item{\bf \textsf{0001}} Reserved.
    \item{\bf \textsf{0010}} \AGL.
    \item{\bf \textsf{0011}} \PC.
    \item{\bf \textsf{0100}} \DR.
    \item{\bf \textsf{0101}} \A.
    \item{\bf \textsf{1000}} \ALU: read from the adder unit.
    \item{\bf \textsf{1001}} \ALU: read from the bitwise AND unit.
    \item{\bf \textsf{1010}} \ALU: read from the bitwise OR unit.
    \item{\bf \textsf{1011}} \ALU: read from the bitwise XOR unit.
    \item{\bf \textsf{1100}} \ALU: read from the roll unit.
    \item{\bf \textsf{1101}} \ALU: read from the bitwise NOT unit.
    \item{\bf \textsf{1110}} Constant Source, bank 1.
    \item{\bf \textsf{1111}} Constant Source, bank 2.
  \end{description}
\item{\bf \WAC} (A19) When low, this signal latches data from the \IBUS{} into the Accumulator.
\item{\bf \WALU} (A20) On the {\em rising edge\/} of this signal, the \ALU's Port B clocks data from the \IBUS{}. (Port A is the Accumulator)
\item{\bf \WDR} (A21) When low, this signal latches data from the \IBUS{} into the Data Register.
\item{\bf \WIR} (A22) The \IR{} reads its value from the \IBUS{} on the {\em rising edge\/} of this signal.
\item{\bf \WMAR} (A23) The \MAR{} reads its value from the \IBUS{} on the {\em rising edge\/} of this signal.
\item{\bf \WPC} (A24) When low, this signal latches data from the \IBUS{} into the Program Counter.
\item{\bf \IRn{2}–\IRn{0}} (A6, B5, A5) Outputs the three least
  significant bits of the Instruction Register. This is used by the
  ALU.
%\item{\bf \OPIFn{3}–\OPIFn{0}} (A27, B27, A26, B26) These signals
%  control the sequencer's skip logic by checking the values of various
%  bits of the \IR. They are used in implementing the ‘minor
%  operations’ instructions {\tt OP1} and {\tt OP2}, which are also
%  responsible for flow control. The defined values of this field are
%  as follows (all other values are unused):
%  \begin{description}
%    \item{\bf \textsf{0000}} Idle; no bit checks performed.
%    \item{\bf \textsf{0001}} Test \IR{} bit 3.
%    \item{\bf \textsf{0010}} Test \IR{} bit 4.
%    \item{\bf \textsf{0011}} Test \IR{} bit 5.
%    \item{\bf \textsf{0100}} Test \IR{} bit 6.
%    \item{\bf \textsf{0101}} Test \IR{} bit 7.
%    \item{\bf \textsf{0110}} Test \IR{} bit 8.
%    \item{\bf \textsf{0111}} Test \IR{} bit 9.
%    \item{\bf \textsf{1011}} Test for a roll operation (any of the
%      three least significant bits of \IR{} being non-zero).
%    \item{\bf \textsf{1111}} Test for a conditional branch operation (any of the
%      four least significant bits of \IR{} being non-zero).
%  \end{description}
\item{\bf \CLL} (B9) When low, this signal clears the Link register.
\item{\bf \CPL} (B10) Open Collector signal, input to the L register. When low,
  this signal complements (toggles) the Link register. Since both the \ALU{}
  and control unit need to do this, an open collector circuit is mandated to
  avoid bus contention.
\item{\bf \RAC} (B19) This signal decodes \RUNITn{}. It is low when
  \RUNITn{3}–\RUNITn{0}=\textsf{0101}, which outputs the Accumulator on the
  \IBUS.
\item{\bf \RAGL} (B20) This signal decodes \RUNITn{}. It is low when
  \RUNITn{3}–\RUNITn{0}=\textsf{0010}, which enables the value of the \AGL{} on
  the \IBUS.
\item{\bf \RDR} (B21) This signal decodes \RUNITn{}. It is low when
  \RUNITn{3}–\RUNITn{0}=\textsf{0100}. This outputs the Data Register on the
  \IBUS.
\item{\bf \RPC} (B22) This signal decodes \RUNITn{}. It is low when
  \RUNITn{3}–\RUNITn{0}=\textsf{0011}. This outputs the Program Counter the
  \IBUS.
\item{\bf \INCAC} (B23) The rising edge of this signal increments the
  Accumulator by one.
\item{\bf \INCDR} (B24) The rising edge of this signal increments the Data
  Register by one.
\item{\bf \INCPC} (B25) The rising edge of this signal increments the Program
  Counter by one.
\item{\bf \MEM} (C13) When low, this signal indicates that a memory read or
  write cycle is taking place. Memory and memory-mapped peripherals attached to
  the computer should respond to this signal by decoding the address bus and
  driving any chip select lines necessary to prepare the memory for I/O.
\item{\bf \IO} (C14) When low, this signal indicates that an I/O space read or
  write cycle is taking place. I/O peripherals should enable register sets and
  other mapped functionality in response to this signal.
\item{\bf \READ} (C15) When low, indicates that a read is taking place. The
  exact timings of a memory or I/O space read cycle are purposefully left
  unspecified in this document.
\item{\bf \WRITE} (C16) Like \READ, when low, indicates that a write cycle is
  taking place.
\end{description}

\subsection{Microcode Control Signals}

These signals control the behaviour of the microcode ROM. They are
inputs to the control unit and in almost all cases are driven
full-time by another unit within the computer. Exceptions are noted.

\begin{description}
\item{\bf \HALT} (A10) Input to the microcode unit, \textbf{open
  collector}. Driving this signal low stops the computer's
  processor. \HALT{} inhibits the microprogram counter (\textsf{μPC})
  and tri-states the microcode ROM. In this state, the computer stops
  executing microinstructions and hence instructions. Control signals
  will are held by a bus hold circuit, but may be overridden by other
  units as long as \HALT{} is asserted. It may also be used by devices
  that do not intend to modify the processor's internal state as a
  means of getting simple, asynchronous wait states. The \HALT{}
  signal {\em must\/} be driven by an open collector circuit to avoid
  contention with other devices asserting it.
\item{\bf \IRQ} (A12) Input to the processor, \textbf{open
  collector}. Asserting this signal notifies the control unit that of
  an interrupt request. The machine allows for only one, maskable
  interrupt. An interrupt controller may be used to provide multiple
  interrupt lines to the expansion bus (eight such lines,
  \IRQn{7}–\IRQn{0} are provided on the expansion bus). For more
  information, please consult \cf{sec-expansion}. Please note that
  this line must be driven using open collector circuitry to avoid bus
  contention.
\item{\bf \IRQS} (A13) Input to the microcode unit. The Interrupt
  Request Seen signal is driven at all times by the internal interrupt
  state machine and is fed directly to the microcode ROM. It is
  asserted at the end of an microprogram if \IRQ{} was asserted during
  execution of the microprogram, and the \Ireg{} is set.
\item{\bf \SKIP} (B7) Input from the Skip and Branch Unit (\SBU) to
  the microcode unit. The \SBU{} asserts this signal when a skip or
  branch must be taken, which in turn branches the current
  microprogram accordingly. The behaviour of the \SBU{} depends on the
  current value of the three flags (signals \FL, \FZERO, \FNEG) and
  the value of the ten least significant bits of the \IR. The
  resultant behaviour of the computer depends on the microcode being
  executed. The \SBU{} asserts this signal at all times but most
  microprograms treat \SKIP{} as a don't-care signal.
\item{\bf \AINDEX} (B8) Input from the autoindex decoder to the
  microcode unit. Based on the programming model, \AINDEX is asserted
  when the \MAR{} is loaded with a value in the range 0080–00FF. The
  signal remains asserted until the end of the currently executed
  microprogram, i.e. until \END{} is asserted.
\end{description}

\subsection{Other Signals}

\begin{description}
\item{\bf \SYSDEV} (A25) This signal simplifies adding I/O-mapped
  devices to the machine. It is low when \MAR{} contains an address in
  the range 0000–00FF. The most significant 8 bits of \MAR{} are fully
  decoded for this.
%\item{\bf \BOE} (B5) Binary Operation Enable. Output by the \ALU{} and
%  used internally to enable the binary operations sub-unit.
%\item{\bf \UOE} (B6) Unary Operation Enable. Output by the \ALU{} and
%  used internally to enable the unary operations sub-unit or the
%  constant source.
\item{\bf \PCn{15}–\PCn{10}} (B17–B12) the six most significant bits
  of the \PC, output at all times. This is the current page of the
  processor, and is used by the \AGL{} to generate addresses from
  instructions.
\item{\bf \ISROLL} (B18) Active high input from the \SBU{} to the
  microcode unit. This signal is asserted when any of the least
  significant three bits of the \IR{} are non-zero. If \ISROLL{} is
  asserted and \OPIFn{3}–\OPIFn{0} is \textsf{1011}, the \SBU{}
  notifies the microcode unit via the \SKIP{} signal that a roll
  operation {\em may\/} be selected. Depending on the current
  microprogram, the microcode can then act on this information. \NB
  The semantics and direction of this signal are under review.
\item{\bf \IBUSn{15}–\IBUSn{0}} (Pins C28–C21 and C12–C5)
  Bi-directional, 16-bit Internal Bus. This is the primary means of
  communicating data within the CFT micro-architecture. Depending on
  the value of \RUNITn{3}–\RUNITn{0} as well as \MEM, \IO{} and \READ,
  various units drive the \IBUS. Most units should float (high
  impedance) their bus drivers whenever \GP{} is asserted (low) to avoid
  bus contention with units that may drive the bus for longer than
  allowed (due to propagation delays, for instance).
\item{\bf \FV} (A26) Active-high output. The current value of the
  Overflow flag. This is an output from the ALU to the control unit.
\item{\bf \FL} (C18) Active-high output. The current value of the Link
  Register (\Lreg). This is an output from the ALU, currently used by
  the control unit.
\item{\bf \FZERO} (C19) Active-high output. \FZERO{} is asserted
  whenever the value of the Accumulator (\A) is zero.
\item{\bf \FNEG} (C20) Active-high output. \FNEG{} is asserted
  whenever the value of \A{} is negative. This is tantamount to bit
  15 of the Accumulator being set.
\end{description}

\subsection{Test Points}

Every slot on the backplane has two local pins, designated \TPA{} (pin
A17) and \TPC{} (pin C17). These are not connected to other slots
(unbussed), but are broken out to test points and pins on the
backplane. They may be used to provide two local signals for debugging
or indicators, or simply for testing. The CFT design does not
currently use them.

\section{Expansion Bus}
\label{sec-expansion}

\begin{table}[t!]
\caption{\label{table-expansion-pinout}Expansion Bus Pin-out. Row B is
  optional. Expansion cards that need no access to the banked memory
  scheme may use 64-pin (A+C) DIN 41612 connectors, which are more
  cost-effective.}  \centering
\begin{tabular}{rp{0.2\columnwidth}p{0.2\columnwidth}p{0.2\columnwidth}}
\noalign{\smallskip}\hline\noalign{\smallskip}
& A & B & C \\
\noalign{\smallskip}\hline\noalign{\smallskip}
 1 & GND         & GND       & GND \\
 2 & GND         & GND       & GND \\
 3 & +5V         & +5V       & +5V \\
 4 & Reserved    & Reserved  & Reserved \\
 5 & \ABUSn{0}   & Reserved  & \DBUSn{0}\\
 6 & \ABUSn{1}   & Reserved  & \DBUSn{1}\\
 7 & \ABUSn{2}   & Reserved  & \DBUSn{2}\\
 8 & \ABUSn{3}   & Reserved  & \DBUSn{3}\\
 9 & \ABUSn{4}   & Reserved  & \DBUSn{4}\\
10 & \ABUSn{5}   & Reserved  & \DBUSn{5}\\
11 & \ABUSn{6}   & Reserved  & \DBUSn{6}\\
12 & \ABUSn{7}   & Reserved  & \DBUSn{7}\\
13 & \IRQn{3}    & \AEXTn{0} & \MEM \\
14 & \IRQn{4}    & \AEXTn{1} & \IO \\
15 & \IRQn{5}    & \AEXTn{2} & \READ \\
16 & \IRQn{6}    & \AEXTn{3} & \WRITE \\
17 & \TPA        & \AEXTn{4} & \TPC \\
18 & \IRQn{7}    & \AEXTn{5} & \IRQn{0} \\
19 & \HALT       & \AEXTn{6} & \IRQn{1} \\
20 & \ABUSn{8}   & \AEXTn{7} & \IRQn{2} \\
21 & \ABUSn{9}   & Reserved  & \DBUSn{8} \\
22 & \ABUSn{10}  & Reserved  & \DBUSn{9} \\
23 & \ABUSn{11}  & Reserved  & \DBUSn{10} \\
24 & \ABUSn{12}  & Reserved  & \DBUSn{11} \\
25 & \ABUSn{13}  & Reserved  & \DBUSn{12} \\
26 & \ABUSn{14}  & Reserved  & \DBUSn{13} \\
27 & \ABUSn{15}  & Reserved  & \DBUSn{14} \\
28 & \GUARDPULSE & Reserved  & \DBUSn{15} \\
29 & \CLOCK{B}   & Reserved  & \CLOCK{A} \\
30 & \RSTHOLD    & Reserved  & \RESET \\
31 & +12V        & +12V      & +12V \\
32 & +5V         & +5V       & +5V \\
\noalign{\smallskip}\hline\noalign{\smallskip}
\end{tabular}
\end{table}

The Expansion Bus provides a computer-level expansion interface. It
allows devices to connect to the memory space, I/O space, and expanded
memory space by using the Address Bus, Data Bus, their associated
control lines, as well as interrupt lines. This is meant for devices
that do not require access to the inner workings of the processor and
its micro-architecture such as memory, serial and parallel interfaces,
disk adapters, and so on.

The expansion bus is designed to allow two different types of cards.

\begin{itemize}
\item Memory cards and exotic devices that might need access to the
  address bus expansion signals (such as framebuffers) need to use a
  96-pin plug (rows A+B+C). Row B, the middle row, contains expanded
  signals and unassigned bus signals available for cards to use.
\item Other peripheral cards can use 64-pin plugs (A+C). DIN-41612
  allows 64-pin plugs to fit 96-pin sockets, and this reduces the cost
  of peripheral cards.
\end{itemize}


\subsection{Power, Synchronisation and Initialisation}

Most of the pins in this category are identical in position and
function to those in the Control bus, dictated to a great extent by
the physical layout of the backplane. Please refer to
\cf{sec-bus-power-clock-reset} for more information.

Power is supplied on four power rails, connected directly to the power
supply.

\begin{description}
\item{\bf GND} (Pins A1–2, B1–2, C1–2) Connected
  to the power supply's ground rail.
\item{\bf +5V} (Pins A3, B3, C3, A32, B32, C32) Connected to the power supply's +5V rail.
\item{\bf Reserved Power Rail} (Pins A4, B4, C4) This is a power rail,
  although the exact voltage to be used has not yet been decided. A
  likely candidate is +3.3V, which is a fairly common voltage for many
  devices.
\item{\bf +12V} (Pins A31, B31, C31) Connected to the power supply's
  +12V rail.
\end{description}

Synchronisation and reset functionality is served by the following
signals, all of which are outputs:

\begin{description}
  \item{\bf \CLOCK{A}} (C29) is identical to, directly connected to,
    and located on the same pin as the Control Bus signal
    \CLOCK{1}. This is the main system clock phase, a 50\% duty cycle
    square wave. The exact period of this clock is beyond the scope of
    this document and is purposefully left unspecified.
  \item{\bf \CLOCK{B}} (A29) is identical to, directly connected to,
    and located on the same pin as the Control Bus signal
    \CLOCK{5}. This is a 75\% duty cycle square wave. Its falling edge
    coincides with the falling edge of \CLOCK{1} and its rising edge
    coincides with the rising edge of \CLOCK{4}, 90° and 25\% of the
    period apart.
  \item{\bf\GP} (A28) The guard pulse is a 25\% (or
    less) duty cycle square wave, with its high level occurring just
    before the rising edge of \CLOCK{1}. It helps resolve bus
    contentions between faster and slower units within the processor
    by forcing most units to disconnect from the \IBUS{} when \GP{} is
    high.
\end{description}

Please refer to~\fcf{fig-clock} for a timing diagram of these clock
phases, and the additional clock phases used only internally by the
control logic.

Resetting the machine is handled by two signals, both of which are
outputs. Devices may reset on the falling edge or low level of either
or both of the two signals:

\begin{description}
  \item{\bf\RESET} (C30) When low, this short pulse indicates that a
    reset sequence has started. This signal may be driven low using an
    open collector to initiate a reset.
  \item{\bf\RSTHOLD} (A30) When low, pulse indicates a reset is in
    progress. This pulse starts shortly after the rising edge of
    \RESET{} and stays low for a relatively long time in terms of the
    machine's clock period.
\end{description}

\subsection{Address, Data and Control Signals}

Devices can use these signals to attach to the computer using a very simple bus protocol with timings identical to those used for static RAMs. The signals, which, to allow for more complex decoding tasks, are somewhat different than RAM signals, are:

\begin{description}
\item{\bf \ABUSn{15}–\ABUSn{0}} (Pins A27–A20 and A12–A5) Output only,
  16-bit Address Bus. This is used by the processor to specify a
  location in memory or I/O space to be written to or read from. The
  Address Bus is always driven by the processor's \MAR{}
  register\footnote{This makes Bus Mastering and Direct Memory Access
    (DMA) impossible, but it is also unnecessary for the CFT.}, so
  devices may never drive it.
\item{\bf \AEXTn{7}–\AEXTn{0}} (Pins B20–B13) Output only. These 8
  lines extend the address space of the CFT architecture by 5 bits, to
  allow for up to 2,097,152 words to be accessed. The technique used
  is banking. Memory cards and memory-mapped devices exposing large
  blocks of memory (such as framebuffers) must use \AEXTn{7}-\AEXTn{0}
  and \ABUSn{12}–\ABUSn{0}. If the device only uses 16 bits of memory,
  it must use \AEXTn{2}–\AEXTn{0} and \ABUSn{12}–\ABUSn{0}. To avoid
  potential clashes between banked and unbanked memory, memory cards
  and memory-mapped devices should not use \ABUSn{15}–\ABUSn{13}. Such
  devices must, by necessity, use 96-pin (row A+B+C) DIN 41612
  connectors.
\item{\bf \DBUSn{15}–\DBUSn{0}} (Pins C28–C21 and C12–C5)
  Bidirectional, 16-bit Data Bus. This is used to transfer data
  between the processor and devices. The Data Bus is connected to the
  processor's Internal Bus by a bus transceiver circuit when any of
  \MEM, \IO, \READ{} or \WRITE{} are asserted (they are asserted in
  pairs of \MEM{} or \IO{} and \READ{} or \WRITE). Devices {\bf must
    not} drive the data bus unless \READ{} and either \MEM{} or \IO{}
  (depending on device application) are asserted, and they have
  decoded the value of the Address Bus. Devices should not read from
  the data bus unless \WRITE{} and either \MEM{} or \IO{} are asserted
  and they have decoded the value of the Address Bus (some hardware,
  such as the front panel interface, may ignore this rule).
\item{\bf \IRQn{7}–\IRQn{0}} (Pins A18, A16–A13, C20–C18) Open
  collector inputs. Actual behaviour depends on the interrupt
  controller installed. At its simplest, all of these signals are
  electrically connected to the \IRQ{} signal in the control logic,
  which is an open collector input, hence the open collector
  designation here. Even with a full-blown interrupt controller,
  however, having open collector outputs facilitates IRQ line sharing
  without glitches or bus contention\footnote{This feature alone makes
    the CFT computer better than the original IBM PC, which was
    plagued for years by improperly designed interrupt mechanisms.}.
\item{\bf \MEM} (C13) When low, this signal indicates that a memory
  read or write cycle is taking place. Memory and memory-mapped
  peripherals attached to the computer should respond to this signal
  by decoding the address bus and driving any chip select lines
  necessary to prepare the memory for I/O.
\item{\bf \IO} (C14) When low, this signal indicates that an I/O space
  read or write cycle is taking place. I/O peripherals should enable
  register sets and other mapped functionality in response to this
  signal.
\item{\bf \READ} (C15) When low, indicates that a read is taking
  place. The exact timings of a memory or I/O space read cycle are
  purposefully left unspecified in this document.
\item{\bf \WRITE} (C16) Like \READ, when low, indicates that a write
  cycle is taking place.
\end{description}

\subsection{Test Points}

Every slot on the backplane has two local pins, designated \TPA{} (pin
A17) and \TPC{} (pin C17). These are not connected to other slots
(unbussed), but are broken out to test points and pins on the
backplane. They may be used to provide two local signals for debugging
or indicators, or simply for testing. The CFT design does not
currently use them.

\section{Bus Bridge}

The purpose of the bus bridge is to connect (electrically or
logically) signals on the Control Bus to signals on the Expansion
Bus. Its functions are:

\begin{itemize}
\item Connecting the outputs of the Memory Address Register (\MAR) to the Address Bus.
\item Connecting, when required, the \IBUS{} to the Data Bus via a bus transceiver.
\item Connecting directly the various control signals that are shared
  between the Control and Expansion buses.
\item Providing Address Space Extension signals to the Expansion Bus.
\item Mapping the \IRQn{7}–\IRQn{0} interrupt request lines to the
  control unit's \IRQ{} signal.
%\item Terminating the Control Bus and Expansion Bus, if necessary.
\end{itemize}

\subsection{Address Space Extension}

The CFT architecture has a 16-bit address space, which allows for
65,536 words of memory or I/O to be addressed. To facilitate accessing
more memory, an Address Space Extension scheme is used. This provides
for an additional 8 signals in row B of the Expansion Bus, namely
\AEXTn{7}–\AEXTn{0}.

An address extension card may drive these signals in one of many ways
for the benefit of memory cards.

Memory cards make up a 21-bit physical address using
\AEXTn{7}–\AEXTn{0} for the most significant 8 bits, and
\ABUSn{12}–\ABUSn{0} for the least significant 13 bits. This allows
for a maximum of 2,097,152 words to be accessed, although this depends
on the address extension scheme implemented.

There are two options at this point:

\begin{itemize}
\item A trivial, low-cost mapping, by grounding \AEXTn{7}–\AEXTn{3}
  and connecting \AEXTn{2}–\AEXTn{0} to \ABUSn{15}–\ABUSn{13}
  respectively. This provides a one-to-one mapping between the control
  unit's address space and the physical address space. Up to 65,536
  words of memory or memory-mapped devices are accessible to the
  processor.
\item A banked memory controller, the specifics of which are beyond
  the scope of this document. As \AEXTn{} extends the address space by
  5 bits, up to 21 bits of memory (or 2,097,152 words) may be
  accessed. Each bank contains 8,192 words. The processor's address
  space is broken into 8 banks. How these 8 banks map to physical
  memory depends on the controller used.
\end{itemize}

\subsection{Interrupt Request Line Mapping}

The Expansion Bus specifies 8 Interrupt Request Lines,
\IRQn{7}–\IRQn{0}. The control unit accommodates a single interrupt
signal, \IRQ.

One of the duties of the bus bridge is to provide a connection or
mapping between these eight lines and the control unit's one. There
are many ways this can be done. The two most obvious ones are as follows:

\begin{itemize}
\item The trivial solution is to directly, electrically connect all
  \IRQ{n} lines to \IRQ. This is possible because these are all open
  collector signals and bus contention is not an issue. Detecting
  which device caused an interrupt is left to the computer's control
  program.
\item An interrupt controller which collects the 8 interrupt request
  lines, possibly masking some of them, and sends an interrupt request
  signal to the processor. The computer's control program can query
  the interrupt controller card to find out which interrupt lines have
  been triggered, and act accordingly. This delegates some of the
  interrupt processing to hardware, and is almost certainly faster
  than the trivial interrupt logic.
\end{itemize}

Either solution may be implemented. Additional, hybrid solutions may
also need to be implemented by hardware that needs additional
interrupt lines or functionality.

\section{Further reading}

For further information on the CFT computer, please consult the
following URL:

\begin{center}
\link{www.bedroomlan.org/hardware/cft}
\end{center}

\begin{figure*}
\centering
\includegraphics[width=0.95\textheight,angle=90]{eagle/bus-wiring.pdf}\\
\caption{\label{fig-schematic-bus-wiring}Schematic drawing of the bus wiring.}
\end{figure*}



\end{document}

%%  LocalWords:  documentclass CFT Alexios PDP autoindexing Von LSI Chouchoulas
%%  LocalWords:  Neumann microprograms microprogram microinstructions Bauform
%%  LocalWords:  et cetera kiloword KWord kilowords KWords Autoindex rp GND CLC
%%  LocalWords:  SUBRET JSR TRAPRET ISRRET ISR autoindex th FC FFF tl RSTIN tri
%%  LocalWords:  FFFF pagerel vlgrey linewidth fillstyle fillcolor de GPULSE
%%  LocalWords:  addr FFFE IOT LIA JMP bitwise ORred asm bitfield CLA DMA IRQ
%%  LocalWords:  CLL RBL RBR RNL RNR NOP linearc SNA SZA SSL SNN SNZ
%%  LocalWords:  SCL CLI STI SNP lll RET RTT SBL SBR SNL SNR TTY
%%  LocalWords:  disjuncted conjuncted ANDed
